<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malek.Art - فن وإبداع</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'navy': '#1a1f36',
                        'navy-light': '#2d3748',
                        'gold': '#d4af37',
                        'light-gold': '#f4e4a6',
                        'dark-bg': '#0f172a'
                    },
                    fontFamily: {
                        'arabic': ['Tajawal', 'Arial', 'sans-serif'],
                        'cairo': ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Tajawal', 'Cairo', Arial, sans-serif; 
            line-height: 1.7;
            overflow-x: hidden;
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #1a1f36 0%, #2d3748 50%, #1a1f36 100%);
            position: relative;
        }
        .gold-gradient { 
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 50%, #d4af37 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .hover-scale { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .hover-scale:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 25px 50px rgba(212, 175, 55, 0.3); }
        .fade-in { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .fade-in.visible { opacity: 1; transform: translateY(0); }
        
        /* Fix Text Breaks */
        h1, h2, h3, p, .text-fix { white-space: normal !important; }

        /* Admin Panel Styles */
        #admin-panel { display: none; }
        .admin-sidebar-link.active { background-color: #d4af37; color: #1a1f36; font-weight: bold; }
        
        /* Loading & Toast */
        #loading-indicator { position: fixed; top: 0; left: 0; right: 0; height: 4px; background: #d4af37; z-index: 10000; transform: scaleX(0); transform-origin: left; transition: transform 0.3s; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1a1f36; color: #d4af37; padding: 10px 20px; border-radius: 8px; z-index: 9999; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid #d4af37; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { margin: 10% auto; padding: 0; width: 90%; max-width: 500px; border-radius: 15px; overflow: hidden; animation: slideDown 0.4s; }
        @keyframes slideDown { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    </style>
</head>
<body class="bg-white text-navy font-arabic">

    <div id="loading-indicator"></div>
    
    <div id="toast" class="toast"><i class="fas fa-check-circle ml-2"></i> <span id="toast-msg">تم الحفظ بنجاح</span></div>

    <div id="login-modal" class="modal">
        <div class="modal-content bg-white shadow-2xl relative">
            <div class="bg-navy p-4 flex justify-between items-center">
                <h3 class="text-gold font-bold text-xl">تسجيل الدخول للإدارة</h3>
                <span class="text-white cursor-pointer text-2xl hover:text-red-500" onclick="closeModal('login-modal')">&times;</span>
            </div>
            <div class="p-8">
                <p class="mb-4 text-gray-600 text-sm">أدخل كلمة المرور للوصول إلى لوحة التحكم</p>
                <input type="password" id="admin-password" placeholder="كلمة المرور" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-gold outline-none">
                <button onclick="attemptLogin()" class="w-full bg-navy text-gold font-bold py-3 rounded-lg hover:bg-opacity-90 transition-all">دخول</button>
            </div>
        </div>
    </div>

    <div id="main-website">
        <nav class="fixed top-0 w-full z-50 gradient-bg shadow-lg">
            <div class="container mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="https://i.ibb.co/VpwXQ08f/M-20250902-011717.jpg" alt="Logo" class="w-10 h-10 md:w-12 md:h-12 ml-2 md:ml-3 rounded-full shadow-lg">
                        <div class="text-xl md:text-2xl font-bold text-gold font-cairo">مالك أرت Malek Art</div>
                    </div>
                    <div class="hidden md:flex space-x-reverse space-x-6 items-center">
                        <a href="#home" class="text-white hover:text-gold transition-colors nav-link">الرئيسية</a>
                        <a href="#about" class="text-white hover:text-gold transition-colors nav-link">من أنا</a>
                        <a href="#services" class="text-white hover:text-gold transition-colors nav-link">الخدمات</a>
                        <a href="#portfolio" class="text-white hover:text-gold transition-colors nav-link">المعرض</a>
                        <a href="#testimonials" class="text-white hover:text-gold transition-colors nav-link">آراء العملاء</a>
                        <a href="#contact" class="text-white hover:text-gold transition-colors nav-link">تواصل معي</a>
                        <button onclick="openLoginModal()" class="bg-gold text-navy px-4 py-1 rounded-full text-sm font-bold hover:bg-white transition-colors">
                            <i class="fas fa-lock ml-1"></i> الإدارة
                        </button>
                    </div>
                    <button class="md:hidden text-white" id="mobile-menu-btn">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
                <div class="md:hidden hidden mt-4 bg-navy rounded-lg p-4" id="mobile-menu">
                    <a href="#home" class="block py-3 text-white hover:text-gold nav-link border-b border-gray-700">الرئيسية</a>
                    <a href="#about" class="block py-3 text-white hover:text-gold nav-link border-b border-gray-700">من أنا</a>
                    <a href="#services" class="block py-3 text-white hover:text-gold nav-link border-b border-gray-700">الخدمات</a>
                    <a href="#portfolio" class="block py-3 text-white hover:text-gold nav-link border-b border-gray-700">المعرض</a>
                    <a href="#contact" class="block py-3 text-white hover:text-gold nav-link">تواصل معي</a>
                    <button onclick="openLoginModal()" class="w-full text-right py-3 text-gold font-bold hover:text-white">
                        <i class="fas fa-lock ml-2"></i> الإدارة
                    </button>
                </div>
            </div>
        </nav>

        <section id="home" class="min-h-screen gradient-bg flex items-center relative overflow-hidden pt-16">
            <div class="absolute inset-0" id="hero-slideshow"></div>
            <div class="absolute inset-0 bg-navy bg-opacity-70"></div>
            <div class="container mx-auto px-4 text-center relative z-10 fade-in">
                <h1 id="view-hero-title" class="text-4xl md:text-6xl font-bold text-white mb-4 font-tajawal leading-tight"></h1>
                <div id="view-hero-subtitle" class="text-xl md:text-2xl text-gold font-semibold mb-8 text-fix"></div>
                <div class="flex justify-center gap-4">
                    <a href="#portfolio" class="gold-gradient text-navy px-8 py-3 rounded-full font-bold hover-scale">استكشف أعمالي</a>
                    <a href="#contact" class="border-2 border-gold text-gold px-8 py-3 rounded-full font-bold hover:bg-gold hover:text-navy transition-all">تواصل معي</a>
                </div>
            </div>
        </section>

        <section id="about" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4 fade-in">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-navy mb-4 font-cairo">من أنا</h2>
                    <div class="w-24 h-1 gold-gradient mx-auto"></div>
                </div>
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div class="text-center">
                        <img id="view-about-image" src="" class="w-64 h-64 mx-auto rounded-full shadow-2xl object-cover border-4 border-gold" onerror="this.src='https://placehold.co/400x400/1a1f36/d4af37?text=Malek'">
                    </div>
                    <div>
                        <h3 id="view-about-title" class="text-2xl font-bold text-navy mb-4"></h3>
                        <p id="view-about-desc" class="text-gray-700 mb-8 leading-relaxed text-lg text-fix"></p>
                        <div id="view-skills-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-3xl font-bold text-navy mb-4">خدماتي</h2>
                    <div class="w-24 h-1 gold-gradient mx-auto"></div>
                </div>
                <div id="view-services-container" class="grid md:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <section id="portfolio" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-3xl font-bold text-navy mb-4">معرض الأعمال</h2>
                    <div class="w-24 h-1 gold-gradient mx-auto"></div>
                </div>
                <div id="view-portfolio-container" class="grid md:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <section id="testimonials" class="py-16 bg-navy relative">
            <div class="container mx-auto px-4 relative z-10">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-3xl font-bold text-white mb-4">آراء العملاء</h2>
                    <div class="w-24 h-1 gold-gradient mx-auto"></div>
                </div>
                <div id="view-testimonials-container" class="grid md:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <section id="contact" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-3xl font-bold text-navy mb-4">تواصل معي</h2>
                    <div class="w-24 h-1 gold-gradient mx-auto"></div>
                </div>
                <div class="grid lg:grid-cols-2 gap-12">
                    <div>
                        <h3 class="text-2xl font-bold text-navy mb-6">معلومات الاتصال</h3>
                        <div id="view-contact-info" class="space-y-6"></div>
                        <div class="mt-8">
                            <h4 class="font-bold text-navy mb-4">تابعني على</h4>
                            <div id="view-social-links" class="flex space-x-reverse space-x-4"></div>
                        </div>
                    </div>
                    <form class="bg-gray-50 p-8 rounded-xl shadow-lg">
                        <div class="mb-4"><input type="text" placeholder="الاسم" class="w-full p-3 border rounded"></div>
                        <div class="mb-4"><input type="email" placeholder="البريد" class="w-full p-3 border rounded"></div>
                        <div class="mb-4"><textarea rows="4" placeholder="الرسالة" class="w-full p-3 border rounded"></textarea></div>
                        <button class="gold-gradient text-navy font-bold w-full py-3 rounded hover-scale">إرسال</button>
                    </form>
                </div>
            </div>
        </section>

        <footer class="bg-navy-light text-white py-8 text-center border-t border-gray-700">
            <div class="container mx-auto">
                <p>&copy; 2026 مالك أرت Malek Art. جميع الحقوق محفوظة.</p>
            </div>
        </footer>
        
        <a href="https://wa.me/967783720851" target="_blank" class="fixed bottom-6 right-6 bg-green-500 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform z-40">
            <i class="fab fa-whatsapp text-3xl"></i>
        </a>
    </div>

    <div id="admin-dashboard" class="hidden min-h-screen bg-gray-100">
        <header class="bg-navy text-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-cogs text-gold text-2xl ml-3"></i>
                    <h1 class="text-xl font-bold">لوحة تحكم مالك أرت</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="resetToDefault()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-600 transition-colors text-sm">
                        <i class="fas fa-sync-alt ml-1"></i> استعادة البيانات الافتراضية
                    </button>
                    <button onclick="saveAllData()" class="bg-gold text-navy px-6 py-2 rounded-lg font-bold hover:bg-white transition-colors">
                        <i class="fas fa-save ml-2"></i> حفظ التغييرات
                    </button>
                    <button onclick="logout()" class="text-red-400 hover:text-red-200 font-bold">
                        <i class="fas fa-sign-out-alt ml-1"></i> خروج
                    </button>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-6">
            <aside class="w-full md:w-64 flex-shrink-0 bg-white rounded-xl shadow-md p-4 h-fit sticky top-24">
                <nav class="space-y-2">
                    <button onclick="switchTab('tab-hero')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors active block">
                        <i class="fas fa-home ml-2 w-6"></i> الرئيسية (Hero)
                    </button>
                    <button onclick="switchTab('tab-about')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors block">
                        <i class="fas fa-user ml-2 w-6"></i> من أنا
                    </button>
                    <button onclick="switchTab('tab-services')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors block">
                        <i class="fas fa-concierge-bell ml-2 w-6"></i> الخدمات
                    </button>
                    <button onclick="switchTab('tab-portfolio')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors block">
                        <i class="fas fa-images ml-2 w-6"></i> المعرض
                    </button>
                    <button onclick="switchTab('tab-testimonials')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors block">
                        <i class="fas fa-comments ml-2 w-6"></i> الآراء
                    </button>
                    <button onclick="switchTab('tab-contact')" class="admin-sidebar-link w-full text-right p-3 rounded-lg hover:bg-gray-100 transition-colors block">
                        <i class="fas fa-address-card ml-2 w-6"></i> التواصل
                    </button>
                </nav>
            </aside>

            <main class="flex-grow bg-white rounded-xl shadow-md p-6 md:p-8">
                <div id="tab-hero" class="admin-tab">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">إعدادات القسم الرئيسي</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block font-bold mb-2">العنوان الرئيسي</label>
                            <input type="text" id="edit-hero-title" class="w-full p-3 border rounded bg-gray-50 focus:ring-gold">
                        </div>
                        <div>
                            <label class="block font-bold mb-2">الوصف الفرعي</label>
                            <input type="text" id="edit-hero-subtitle" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block font-bold mb-2">صور الخلفية (رابط لكل سطر)</label>
                            <textarea id="edit-hero-images" rows="5" class="w-full p-3 border rounded bg-gray-50" placeholder="https://example.com/image1.jpg"></textarea>
                            <small class="text-gray-500">ضع كل رابط صورة في سطر جديد</small>
                        </div>
                    </div>
                </div>

                <div id="tab-about" class="admin-tab hidden">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">بيانات "من أنا"</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block font-bold mb-2">العنوان</label>
                            <input type="text" id="edit-about-title" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block font-bold mb-2">رابط الصورة الشخصية</label>
                            <input type="text" id="edit-about-image" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block font-bold mb-2">الوصف التفصيلي</label>
                            <textarea id="edit-about-desc" rows="4" class="w-full p-3 border rounded bg-gray-50"></textarea>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-navy mt-8 mb-4">المهارات</h3>
                    <div id="admin-skills-list" class="space-y-4"></div>
                    <button onclick="addSkillInput()" class="mt-4 text-gold font-bold hover:underline">+ إضافة مهارة</button>
                </div>

                <div id="tab-services" class="admin-tab hidden">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">إدارة الخدمات</h2>
                    <div id="admin-services-list" class="grid gap-6"></div>
                    <button onclick="addServiceInput()" class="mt-6 bg-navy text-white px-6 py-3 rounded-lg w-full font-bold hover:bg-opacity-90">+ إضافة خدمة جديدة</button>
                </div>

                <div id="tab-portfolio" class="admin-tab hidden">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">إدارة الأعمال (Portfolio)</h2>
                    <div id="admin-portfolio-list" class="grid gap-8"></div>
                    <button onclick="addPortfolioInput()" class="mt-6 bg-navy text-white px-6 py-3 rounded-lg w-full font-bold hover:bg-opacity-90">+ إضافة عمل جديد</button>
                </div>

                <div id="tab-testimonials" class="admin-tab hidden">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">آراء العملاء</h2>
                    <div id="admin-testimonials-list" class="grid gap-6"></div>
                    <button onclick="addTestimonialInput()" class="mt-6 bg-navy text-white px-6 py-3 rounded-lg w-full font-bold hover:bg-opacity-90">+ إضافة رأي جديد</button>
                </div>

                 <div id="tab-contact" class="admin-tab hidden">
                    <h2 class="text-2xl font-bold text-navy mb-6 border-b pb-2">معلومات التواصل</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block font-bold mb-2">رقم الهاتف</label>
                            <input type="text" id="edit-contact-phone" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block font-bold mb-2">البريد الإلكتروني</label>
                            <input type="text" id="edit-contact-email" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block font-bold mb-2">العنوان / الموقع</label>
                            <input type="text" id="edit-contact-address" class="w-full p-3 border rounded bg-gray-50">
                        </div>
                        
                        <h3 class="font-bold text-navy mt-4">روابط التواصل الاجتماعي</h3>
                        <div id="admin-social-list" class="space-y-3"></div>
                        <button onclick="addSocialInput()" class="text-gold font-bold hover:underline">+ إضافة رابط</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const DB_URL = "https://malek9art-fa984-default-rtdb.firebaseio.com/";
        const ADMIN_PASS = "malek9art###";
        
        // --- GLOBAL STATE ---
        let siteData = {};

        // --- CLEAN DATA (Corrected) ---
        // Clean strings manually to ensure no newlines
        const defaultData = {
            hero: {
                title: "مرحبا بك",
                subtitle: "نبتكر حلولا رقمية تجمع بين الفن والتسويق",
                images: [
                    "https://i.ibb.co/bjwqZYSm/m7srer.jpg",
                    "https://i.ibb.co/NvP5gQR/Free-Professional-Office-Logo-Mockup.png",
                    "https://i.ibb.co/bgy3fRPS/Elegant-luxurious-black-box-golden-brand-logo-mockup.png",
                    "https://i.ibb.co/dJ0H8r7v/3-D-Office-Logo-Mockup.png"
                ]
            },
            about: {
                title: "مطور ومنسق مشاريع رقمية",
                description: "أنا مالك، مطور ومنسق مشاريع رقمية أبتكر حلولاً رقمية مبتكرة.",
                image: "https://i.ibb.co/dJ4SVw9W/Blue-Simple-Business-Professional-Linked-In-Profile-Picture-20250902-003847.jpg",
                skills: [
                    { name: "التصميم الجرافيكي", percent: 90 },
                    { name: "تصميم الويب", percent: 85 },
                    { name: "التصميم الإبداعي", percent: 90 },
                    { name: "المهارات التقنية", percent: 80 },
                    { name: "الإبداع والابتكار", percent: 94 }
                ]
            },
            services: [
                { title: "الهوية البصرية المتكاملة", icon: "fas fa-palette", desc: "تصميم هوية بصرية متكاملة (شعار، دليل أنظمة، بطاقات عمل) تعبر عن روح علامتك التجارية." },
                { title: "تصميم مواقع ويب متجاوبة", icon: "fas fa-laptop-code", desc: "تطوير مواقع ويب احترافية متكاملة مع أحدث تقنيات التصميم والتجربة البصرية" },
                { title: "تصميم إعلانات مخصصة", icon: "fas fa-bullhorn", desc: "إعلانات جذابة لوسائل التواصل الاجتماعي والمطبوعات تركز على تحقيق أعلى معدلات التفاعل." },
                { title: "تصميم دعوات ومناسبات", icon: "fas fa-envelope-open-text", desc: "تصميم دعوات فاخرة للمناسبات الخاصة (أعراس، أعياد، خطوبة) بتفاصيل فنية مبتكرة" },
                { title: "عروض تقديمية احترافية", icon: "fas fa-desktop", desc: "عروض تقديمية تفاعلية للشركات والأفراد تجمع بين الإبداع البصري وقوة المحتوى" },
                { title: "تصميم سير ذاتية متميزة", icon: "fas fa-file-alt", desc: "سير ذاتية إحترافية بتصميم فريد يبرز مهاراتك وخبراتك بطريقة مميزة" },
                { title: "تصميم أغلفة وسائل التواصل", icon: "fas fa-film", desc: "تصميم أغلفة وقوالب متجانسة لوسائل التواصل الاجتماعي تعزز هويتك الرقمية" },
                { title: "تصميم عبوات وتغليف", icon: "fas fa-gift", desc: "تصميم عبوات منتجات جذابة تحكي قصة علامتك التجارية وتلفت انتباه العملاء" }
            ],
            testimonials: [
                { name: "نايف سلطان", text: "صمم لي عدة اعلانات لوسائل التواصل الاجتماعي وتهنئات وقام بتسجيل المحل في قوقل ماب أشكره جدا وأنصح الجميع بالتعامل معه" },
                { name: "عبد الحميد محمد", text: "عمل لي موقع إلكتروني ومنشورات السوشل ميديا عمل احترافي وتصاميم أنيقة يستحق كل الشكر" },
                { name: "القدسي", text: "صمم لي شعار وهوية تجارية احترافية ولوحة المحل أشكره جدا ما يقصر" },
                { name: "فضل القعيش", text: "صمم لي عدة تهنئات واحتفالات رسمية بتصميمات أنيقة واحترافية" },
                { name: "أمل محمد - خريجة جامعية", text: "صمم لي سيرة ذاتية احترافية بلغتين" },
                { name: "محلات السلام التجارية", text: "صمم لي منشورات سوشيال ميديا حملة" }
            ],
            contact: {
                phone: "+967783720851",
                email: "malek9art@gmail.com",
                address: "الجمهورية اليمنية",
                social: [
                    { platform: "WhatsApp", link: "https://wa.me/967783720851", icon: "fab fa-whatsapp" },
                    { platform: "Instagram", link: "https://www.instagram.com/m7srer", icon: "fab fa-instagram" },
                    { platform: "Pinterest", link: "https://pin.it/5v0u", icon: "fab fa-pinterest" },
                    { platform: "Twitter", link: "https://x.com/m7", icon: "fab fa-twitter" }
                ]
            },
            portfolio: [] 
        };

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', async () => {
            updateLoading(0.3);
            await fetchAndRenderData();
            updateLoading(1.0);
            
            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });
        });

        function updateLoading(percent) {
            const bar = document.getElementById('loading-indicator');
            bar.style.transform = `scaleX(${percent})`;
            if (percent >= 1) {
                setTimeout(() => { bar.style.opacity = '0'; }, 500);
            }
        }

        // --- DATABASE FUNCTIONS (CRUD) ---
        async function fetchAndRenderData() {
            try {
                const response = await fetch(`${DB_URL}.json`);
                let data = await response.json();

                // Check if data is empty OR contains bad newlines in title/subtitle
                let needsCleaning = false;
                if (!data) {
                    needsCleaning = true;
                } else if (data.hero && (data.hero.title.includes('\n') || data.hero.subtitle.includes('\n'))) {
                    console.log("Detected broken text. forcing clean...");
                    needsCleaning = true;
                }

                if (needsCleaning) {
                    console.log("Seeding CLEAN default data...");
                    data = defaultData;
                    // Force update DB with clean data
                    await fetch(`${DB_URL}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(defaultData)
                    });
                }
                
                siteData = data;
                renderWebsite(siteData);
            } catch (error) {
                console.error("Error fetching data:", error);
                siteData = defaultData;
                renderWebsite(siteData);
            }
        }

        async function saveAllData() {
            // Collect data from Admin Forms
            const newData = {
                hero: {
                    title: document.getElementById('edit-hero-title').value.replace(/\n/g, ' ').trim(), // Clean newlines on save
                    subtitle: document.getElementById('edit-hero-subtitle').value.replace(/\n/g, ' ').trim(),
                    images: document.getElementById('edit-hero-images').value.split('\n').filter(url => url.trim() !== '')
                },
                about: {
                    title: document.getElementById('edit-about-title').value.replace(/\n/g, ' ').trim(),
                    description: document.getElementById('edit-about-desc').value.replace(/\n/g, ' ').trim(),
                    image: document.getElementById('edit-about-image').value.trim(),
                    skills: getSkillsFromAdmin()
                },
                services: getServicesFromAdmin(),
                portfolio: getPortfolioFromAdmin(),
                testimonials: getTestimonialsFromAdmin(),
                contact: {
                    phone: document.getElementById('edit-contact-phone').value,
                    email: document.getElementById('edit-contact-email').value,
                    address: document.getElementById('edit-contact-address').value,
                    social: getSocialFromAdmin()
                }
            };

            try {
                await fetch(`${DB_URL}.json`, {
                    method: 'PUT',
                    body: JSON.stringify(newData)
                });
                siteData = newData;
                renderWebsite(siteData); 
                showToast("تم حفظ التغييرات بنجاح!");
            } catch (error) {
                console.error("Save error:", error);
                alert("فشل الحفظ. تحقق من الانترنت.");
            }
        }
        
        async function resetToDefault() {
            if(confirm("هل أنت متأكد من استعادة البيانات الافتراضية؟ سيتم مسح التغييرات الحالية.")) {
                try {
                    await fetch(`${DB_URL}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(defaultData)
                    });
                    siteData = defaultData;
                    renderWebsite(siteData);
                    populateAdminForms(siteData);
                    showToast("تمت استعادة البيانات الافتراضية بنجاح");
                } catch(error) {
                    alert("حدث خطأ أثناء الاستعادة");
                }
            }
        }

        // --- RENDER FUNCTIONS (VIEW) ---
        function renderWebsite(data) {
            if(!data) return;

            // CLEAN ON RENDER (Safety net)
            // Even if DB has newlines, we replace them with spaces for display
            const safeHeroTitle = data.hero?.title ? data.hero.title.replace(/\n/g, ' ') : "";
            const safeHeroSub = data.hero?.subtitle ? data.hero.subtitle.replace(/\n/g, ' ') : "";
            const safeAboutDesc = data.about?.description ? data.about.description.replace(/\n/g, ' ') : "";

            // Hero
            if (data.hero) {
                document.getElementById('view-hero-title').textContent = safeHeroTitle;
                document.getElementById('view-hero-subtitle').textContent = safeHeroSub;
                // Slideshow logic
                const heroContainer = document.getElementById('hero-slideshow');
                heroContainer.innerHTML = '';
                if(data.hero.images && data.hero.images.length > 0) {
                    data.hero.images.forEach((url, index) => {
                        const div = document.createElement('div');
                        div.className = 'absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ' + (index === 0 ? 'opacity-100' : 'opacity-0');
                        div.style.backgroundImage = `url('${url}')`;
                        heroContainer.appendChild(div);
                    });
                    startSlideshow();
                }
            }

            // About
            if (data.about) {
                document.getElementById('view-about-title').textContent = data.about.title;
                document.getElementById('view-about-desc').textContent = safeAboutDesc;
                document.getElementById('view-about-image').src = data.about.image;
                
                const skillsContainer = document.getElementById('view-skills-container');
                skillsContainer.innerHTML = '';
                if (data.about.skills) {
                    data.about.skills.forEach(skill => {
                        skillsContainer.innerHTML += `
                            <div class="bg-white p-3 rounded shadow">
                                <div class="flex justify-between mb-1">
                                    <span class="font-bold text-navy">${skill.name}</span>
                                    <span class="text-gold font-bold">${skill.percent}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gold h-2 rounded-full" style="width: ${skill.percent}%"></div>
                                </div>
                            </div>
                        `;
                    });
                }
            }

            // Services
            const servicesContainer = document.getElementById('view-services-container');
            servicesContainer.innerHTML = '';
            if (data.services) {
                data.services.forEach(s => {
                    servicesContainer.innerHTML += `
                        <div class="p-6 bg-gray-50 rounded-xl shadow hover-scale border border-gray-100">
                            <div class="w-14 h-14 bg-navy text-gold rounded-full flex items-center justify-center mb-4 text-2xl">
                                <i class="${s.icon}"></i>
                            </div>
                            <h3 class="text-xl font-bold text-navy mb-2">${s.title}</h3>
                            <p class="text-gray-600">${s.desc}</p>
                        </div>
                    `;
                });
            }

            // Portfolio
            const portfolioContainer = document.getElementById('view-portfolio-container');
            portfolioContainer.innerHTML = '';
            if (data.portfolio && data.portfolio.length > 0) {
                data.portfolio.forEach(p => {
                    portfolioContainer.innerHTML += `
                        <div class="bg-white rounded-xl overflow-hidden shadow-lg group">
                            <div class="relative overflow-hidden h-64">
                                <img src="${p.image}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                                <div class="absolute inset-0 bg-navy bg-opacity-60 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center">
                                    <a href="${p.link}" target="_blank" class="bg-gold text-navy px-6 py-2 rounded-full font-bold transform translate-y-4 group-hover:translate-y-0 transition duration-300">عرض</a>
                                </div>
                            </div>
                            <div class="p-6">
                                <span class="text-xs text-gold uppercase tracking-wider font-bold">${p.category}</span>
                                <h3 class="text-xl font-bold text-navy mt-1">${p.title}</h3>
                            </div>
                        </div>
                    `;
                });
            } else {
                portfolioContainer.innerHTML = `<p class="text-gray-500 col-span-3 text-center">سيتم إضافة الأعمال قريباً...</p>`;
            }

            // Testimonials
            const testContainer = document.getElementById('view-testimonials-container');
            testContainer.innerHTML = '';
            if(data.testimonials) {
                data.testimonials.forEach(t => {
                    testContainer.innerHTML += `
                        <div class="bg-white bg-opacity-10 p-6 rounded-xl backdrop-blur-sm border border-gold border-opacity-20">
                            <div class="text-gold text-2xl mb-4"><i class="fas fa-quote-right"></i></div>
                            <p class="text-light-gold mb-4 text-lg">"${t.text}"</p>
                            <h4 class="font-bold text-white text-xl">- ${t.name}</h4>
                        </div>
                    `;
                });
            }

            // Contact
            if(data.contact) {
                const contactDiv = document.getElementById('view-contact-info');
                contactDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center ml-4 text-navy"><i class="fas fa-phone"></i></div>
                        <div><p class="font-bold text-navy">الهاتف</p><p class="text-gray-600">${data.contact.phone}</p></div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center ml-4 text-navy"><i class="fas fa-envelope"></i></div>
                        <div><p class="font-bold text-navy">البريد</p><p class="text-gray-600">${data.contact.email}</p></div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center ml-4 text-navy"><i class="fas fa-map-marker-alt"></i></div>
                        <div><p class="font-bold text-navy">العنوان</p><p class="text-gray-600">${data.contact.address}</p></div>
                    </div>
                `;

                // Social Links
                const socialDiv = document.getElementById('view-social-links');
                socialDiv.innerHTML = '';
                if(data.contact.social) {
                    data.contact.social.forEach(s => {
                        socialDiv.innerHTML += `
                            <a href="${s.link}" target="_blank" class="w-10 h-10 bg-navy text-white rounded-full flex items-center justify-center hover:bg-gold transition-colors">
                                <i class="${s.icon}"></i>
                            </a>
                        `;
                    });
                }
            }
        }

        // --- ADMIN LOGIC ---
        function openLoginModal() { document.getElementById('login-modal').style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function attemptLogin() {
            const pass = document.getElementById('admin-password').value;
            if(pass === ADMIN_PASS) {
                closeModal('login-modal');
                enterAdminMode();
            } else {
                alert("كلمة المرور غير صحيحة");
            }
        }

        function enterAdminMode() {
            document.getElementById('main-website').style.display = 'none';
            document.getElementById('admin-dashboard').classList.remove('hidden');
            populateAdminForms(siteData);
        }

        function logout() {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('main-website').style.display = 'block';
        }

        function populateAdminForms(data) {
            // Hero
            // Clean newlines in input forms
            document.getElementById('edit-hero-title').value = data.hero?.title ? data.hero.title.replace(/\n/g, ' ') : "";
            document.getElementById('edit-hero-subtitle').value = data.hero?.subtitle ? data.hero.subtitle.replace(/\n/g, ' ') : "";
            document.getElementById('edit-hero-images').value = data.hero?.images ? data.hero.images.join('\n') : "";

            // About
            document.getElementById('edit-about-title').value = data.about?.title ? data.about.title.replace(/\n/g, ' ') : "";
            document.getElementById('edit-about-desc').value = data.about?.description ? data.about.description.replace(/\n/g, ' ') : "";
            document.getElementById('edit-about-image').value = data.about?.image || "";
            
            // Skills
            const skillsList = document.getElementById('admin-skills-list');
            skillsList.innerHTML = '';
            if(data.about?.skills) {
                data.about.skills.forEach(skill => addSkillInput(skill.name, skill.percent));
            }

            // Services
            const servList = document.getElementById('admin-services-list');
            servList.innerHTML = '';
            if(data.services) {
                data.services.forEach(s => addServiceInput(s.title, s.icon, s.desc));
            }

            // Portfolio
            const portList = document.getElementById('admin-portfolio-list');
            portList.innerHTML = '';
            if(data.portfolio) {
                data.portfolio.forEach(p => addPortfolioInput(p.title, p.category, p.image, p.link));
            }

            // Testimonials
            const testList = document.getElementById('admin-testimonials-list');
            testList.innerHTML = '';
            if(data.testimonials) {
                data.testimonials.forEach(t => addTestimonialInput(t.name, t.text));
            }

            // Contact
            document.getElementById('edit-contact-phone').value = data.contact?.phone || "";
            document.getElementById('edit-contact-email').value = data.contact?.email || "";
            document.getElementById('edit-contact-address').value = data.contact?.address || "";
            
            const socialList = document.getElementById('admin-social-list');
            socialList.innerHTML = '';
            if(data.contact?.social) {
                data.contact.social.forEach(s => addSocialInput(s.platform, s.link, s.icon));
            }
        }

        // --- Dynamic Form Generators ---
        function addSkillInput(name="", percent="") {
            const div = document.createElement('div');
            div.className = "flex gap-2 items-center skill-item bg-gray-50 p-2 rounded";
            div.innerHTML = `
                <input type="text" placeholder="اسم المهارة" class="skill-name p-2 border rounded w-1/2" value="${name}">
                <input type="number" placeholder="%" class="skill-percent p-2 border rounded w-1/4" value="${percent}">
                <button onclick="this.parentElement.remove()" class="text-red-500 font-bold px-2">X</button>
            `;
            document.getElementById('admin-skills-list').appendChild(div);
        }

        function addServiceInput(title="", icon="fas fa-star", desc="") {
            const div = document.createElement('div');
            div.className = "service-item bg-gray-50 p-4 rounded border border-gray-200";
            div.innerHTML = `
                <div class="grid md:grid-cols-2 gap-2 mb-2">
                    <input type="text" class="serv-title p-2 border rounded" placeholder="عنوان الخدمة" value="${title}">
                    <input type="text" class="serv-icon p-2 border rounded" placeholder="أيقونة (مثال: fas fa-code)" value="${icon}">
                </div>
                <textarea class="serv-desc w-full p-2 border rounded" placeholder="وصف الخدمة">${desc}</textarea>
                <button onclick="this.parentElement.remove()" class="text-red-500 text-sm mt-1">حذف الخدمة</button>
            `;
            document.getElementById('admin-services-list').appendChild(div);
        }

        function addPortfolioInput(title="", category="", image="", link="") {
            const div = document.createElement('div');
            div.className = "portfolio-item-admin bg-gray-50 p-4 rounded border border-gray-200";
            div.innerHTML = `
                <div class="grid md:grid-cols-2 gap-2 mb-2">
                    <input type="text" class="port-title p-2 border rounded" placeholder="اسم المشروع" value="${title}">
                    <input type="text" class="port-cat p-2 border rounded" placeholder="التصنيف" value="${category}">
                </div>
                <div class="grid md:grid-cols-2 gap-2">
                    <input type="text" class="port-img p-2 border rounded" placeholder="رابط الصورة" value="${image}">
                    <input type="text" class="port-link p-2 border rounded" placeholder="رابط المشروع" value="${link}">
                </div>
                <button onclick="this.parentElement.remove()" class="text-red-500 text-sm mt-2">حذف المشروع</button>
            `;
            document.getElementById('admin-portfolio-list').appendChild(div);
        }

        function addTestimonialInput(name="", text="") {
            const div = document.createElement('div');
            div.className = "test-item bg-gray-50 p-4 rounded border border-gray-200";
            div.innerHTML = `
                <input type="text" class="test-name w-full p-2 border rounded mb-2" placeholder="اسم العميل" value="${name}">
                <textarea class="test-text w-full p-2 border rounded" placeholder="الرأي">${text}</textarea>
                <button onclick="this.parentElement.remove()" class="text-red-500 text-sm mt-1">حذف</button>
            `;
            document.getElementById('admin-testimonials-list').appendChild(div);
        }
        
        function addSocialInput(platform="", link="", icon="fab fa-link") {
            const div = document.createElement('div');
            div.className = "social-item bg-gray-50 p-2 rounded border border-gray-200 flex gap-2";
            div.innerHTML = `
                <input type="text" class="social-plat p-2 border rounded w-1/4" placeholder="المنصة" value="${platform}">
                <input type="text" class="social-link p-2 border rounded w-1/2" placeholder="الرابط" value="${link}">
                <input type="text" class="social-icon p-2 border rounded w-1/4" placeholder="الأيقونة" value="${icon}">
                <button onclick="this.parentElement.remove()" class="text-red-500 font-bold">X</button>
            `;
            document.getElementById('admin-social-list').appendChild(div);
        }

        // --- DATA COLLECTION HELPERS ---
        function getSkillsFromAdmin() {
            const items = document.querySelectorAll('.skill-item');
            return Array.from(items).map(item => ({
                name: item.querySelector('.skill-name').value,
                percent: item.querySelector('.skill-percent').value
            }));
        }

        function getServicesFromAdmin() {
            const items = document.querySelectorAll('.service-item');
            return Array.from(items).map(item => ({
                title: item.querySelector('.serv-title').value,
                icon: item.querySelector('.serv-icon').value,
                desc: item.querySelector('.serv-desc').value
            }));
        }

        function getPortfolioFromAdmin() {
            const items = document.querySelectorAll('.portfolio-item-admin');
            return Array.from(items).map(item => ({
                title: item.querySelector('.port-title').value,
                category: item.querySelector('.port-cat').value,
                image: item.querySelector('.port-img').value,
                link: item.querySelector('.port-link').value
            }));
        }

        function getTestimonialsFromAdmin() {
            const items = document.querySelectorAll('.test-item');
            return Array.from(items).map(item => ({
                name: item.querySelector('.test-name').value,
                text: item.querySelector('.test-text').value
            }));
        }
        
        function getSocialFromAdmin() {
            const items = document.querySelectorAll('.social-item');
            return Array.from(items).map(item => ({
                platform: item.querySelector('.social-plat').value,
                link: item.querySelector('.social-link').value,
                icon: item.querySelector('.social-icon').value
            }));
        }

        // --- UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            document.querySelectorAll('.admin-sidebar-link').forEach(l => l.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        let slideIndex = 0;
        function startSlideshow() {
            const slides = document.querySelectorAll('#hero-slideshow div');
            if(slides.length < 2) return;
            setInterval(() => {
                slides[slideIndex].classList.remove('opacity-100');
                slides[slideIndex].classList.add('opacity-0');
                slideIndex = (slideIndex + 1) % slides.length;
                slides[slideIndex].classList.remove('opacity-0');
                slides[slideIndex].classList.add('opacity-100');
            }, 5000);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').textContent = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }
    </script>
</body>
</html>
